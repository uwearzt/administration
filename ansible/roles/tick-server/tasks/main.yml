# ------------------------------------------------------------------------------
# Copyright 2019 Uwe Arzt, mail@uwe-arzt.de
# SPDX-License-Identifier: Apache-2.0
# ------------------------------------------------------------------------------

---
- name: install tick stack
  block:
  - name: add tick repo key
    apt_key:
      url: https://repos.influxdata.com/influxdb.key
      state: present

  - name: add tick repo
    apt_repository:
      repo: deb https://repos.influxdata.com/ubuntu {{ ansible_distribution_release }} stable
      filename: tick
      state: present

  - name: apt
    apt:
      name: "{{ packages }}"
    vars:
      packages:
      - influxdb
      - chronograf
      - kapacitor

  - name: install influxdb service
    service:
      name: influxdb
      enabled: yes
      state: started
  - name: install chronograf service
    service:
      name: chronograf
      enabled: yes
      state: started
  - name: install kapacitor service
    service:
      name: kapacitor
      enabled: yes
      state: started
  become: true
  when: ansible_os_family == "Debian"
